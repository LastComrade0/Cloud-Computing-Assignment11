name: Maven CI (Backend)
on: { push: { branches: ["main"] } }
jobs:
  build-and-push:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with: { distribution: temurin, java-version: '17' }
      - name: Build jar
        working-directory: book-portal-be
        run: mvn -B -DskipTests clean package
      - uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_HUB_USERNAME }}
          password: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN_TWO }}
      - uses: docker/build-push-action@v6
        with:
          context: .
          file: book-portal-be/Dockerfile
          push: true
          tags: ${{ secrets.DOCKER_HUB_USERNAME }}/book-portal-be:latest
